(this["webpackJsonpf2e-week2"]=this["webpackJsonpf2e-week2"]||[]).push([[0],{108:function(t,e,n){},109:function(t,e,n){},111:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(43),o=n.n(i),c=n(138),s=n(22),l=n.n(s),d=n(30),u=n(7),p=n(31),j=n.n(p),b=n(139),h=n(71),x=n.n(h),f=n(70),O=n.n(f),g=n(72);function m(){var t=(new Date).toGMTString(),e=new g.a("SHA-1","TEXT");return e.setHMACKey("Pn9PITNbREc7_yBevt-7udS0UOE","TEXT"),e.update("x-date: "+t),{Authorization:'hmac username="125f67eef61d44189819c6378e4da9cb", algorithm="hmac-sha1", headers="x-date", signature="'+e.getHMAC("B64")+'"',"X-Date":t}}var v=n(140),S=n(141),y=n(1);function k(t){var e=t.list,n=t.handleClick;return e.map((function(t,e){return Object(y.jsxs)(v.a,{style:{padding:"16px",marginTop:0===e?"0":"10px"},onClick:function(){return n(t)},children:[Object(y.jsx)("h3",{children:t.RouteName}),Object(y.jsx)(S.a,{style:{margin:"4px auto"}}),Object(y.jsxs)("div",{style:{display:"flex"},children:[(t.RoadSectionStart||t.RoadSectionEnd)&&Object(y.jsxs)("div",{children:[t.RoadSectionStart&&Object(y.jsxs)("div",{style:{margin:"12px auto"},children:[Object(y.jsx)("span",{style:{fontSize:"10px",fontWeight:"bold",color:"red",padding:"4px",border:"solid 3px red",borderRadius:"50%"},children:"\u8d77"}),Object(y.jsx)("span",{style:{fontSize:"12px",marginLeft:"4px"},children:t.RoadSectionStart})]}),t.RoadSectionStart&&Object(y.jsxs)("div",{children:[Object(y.jsx)("span",{style:{fontSize:"10px",fontWeight:"bold",color:"red",padding:"4px",border:"solid 3px red",borderRadius:"50%"},children:"\u8fc4"}),Object(y.jsx)("span",{style:{fontSize:"12px",marginLeft:"4px"},children:t.RoadSectionEnd})]})]}),Object(y.jsxs)("div",{style:{margin:"auto 0 auto auto",textAlign:"center"},children:[Object(y.jsx)("p",{style:{fontSize:"10px",paddingTop:"16px"},children:"\u5168\u9577"}),Object(y.jsxs)("p",{style:{fontWeight:"bold",color:"red"},children:[t.CyclingLength," \u516c\u91cc"]})]})]})]},e)}))}var w=n(20),T=n(137),C=[{color:"red",text:"\u505c\u6b62\u71df\u904b"},{color:"green",text:"\u6b63\u5e38\u71df\u904b"},{color:"yellow",text:"\u66ab\u505c\u71df\u904b"}];function R(t){var e=t.bikeStationUid,n=r.a.useState(),a=Object(u.a)(n,2),i=a[0],o=a[1];r.a.useEffect((function(){var t=Object(d.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j()({method:"get",url:"https://ptx.transportdata.tw/MOTC/v2/Bike/Station/Taipei?$filter=StationUID%20eq%20%27".concat(e,"%27&$top=1&$format=JSON"),headers:m()});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))(),n=Object(d.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j()({method:"get",url:"https://ptx.transportdata.tw/MOTC/v2/Bike/Availability/Taipei?$filter=StationUID%20eq%20%27".concat(e,"%27&$top=1&$format=JSON"),headers:m()});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))();Promise.all([t,n]).then((function(t){var e;t.forEach((function(t){e=Object(w.a)(Object(w.a)({},e),t.data[0])})),o(e)})).catch((function(t){return console.log(t)}))}),[e]);var c=function(t,e){var n;switch(t){case"serviceStatus":n=C[e];break;case"serviceType":n={text:"YouBike".concat(e,".0")}}return Object(y.jsx)(T.a,{size:"small",label:Object(y.jsxs)("p",{children:[n.color&&Object(y.jsx)("span",{style:{color:n.color},children:"\u25cf "}),n.text]})})};return i?Object(y.jsxs)(v.a,{style:{padding:"16px"},children:[Object(y.jsx)("h3",{children:i.StationName.Zh_tw}),Object(y.jsx)("p",{children:i.AuthorityID}),Object(y.jsx)(S.a,{style:{margin:"8px auto"}}),Object(y.jsxs)("div",{children:[c("serviceStatus",i.ServiceStatus),Object(y.jsx)("span",{style:{marginLeft:"8px"}}),c("serviceType",i.ServiceType)]}),Object(y.jsxs)("div",{style:{display:"flex",marginTop:"8px",textAlign:"center"},children:[Object(y.jsxs)("p",{style:{flexGrow:1,padding:"8px",backgroundColor:"#dbf0d2",color:"green",borderRadius:"4px 0 0 4px"},children:["\u53ef\u79df ",Object(y.jsx)("span",{style:{fontWeight:"bold"},children:i.AvailableRentBikes})]}),Object(y.jsxs)("p",{style:{flexGrow:1,padding:"8px",backgroundColor:"green",color:"#fff",borderRadius:"0 4px 4px 0"},children:["\u53ef\u9084 ",Object(y.jsx)("span",{style:{fontWeight:"bold"},children:i.AvailableReturnBikes})]})]}),Object(y.jsxs)("small",{children:["\u66f4\u65b0\u6642\u9593\uff1a",i.UpdateTime.replace("T"," ").replace(/\+\d*\:\d*/,"")]})]}):null}n(64);var E=n(129),U=n(130),z=n(131),N=n(132),A=n(142),B=n(133),I=n(19),L=n.n(I),$=n.p+"static/media/venue_location_icon.1b60bdb7.svg",M=n.p+"static/media/here_location_icon.a67deb53.svg",P=function(t){return L.a.icon({iconUrl:"here"===t?M:$,iconRetinaUrl:"here"===t?M:$,iconAnchor:null,shadowUrl:null,shadowSize:null,shadowAnchor:null,iconSize:[35,35],className:"leaflet-venue-icon"})},_=P();function D(t){var e=t.markers,n=t.type,a=t.setbikeStationUid,i=Object(E.a)(),o=r.a.useState(e),c=Object(u.a)(o,2),s=c[0],p=c[1];return r.a.useEffect((function(){if(i&&n){var t=i.getCenter(),e=t.lat,a=t.lng;if("bike"===n[0])Object(d.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j()({method:"get",url:"https://ptx.transportdata.tw/MOTC/v2/Bike/Station/NearBy?$top=".concat(30,"&$spatialFilter=nearby(").concat(e,"%2C%20").concat(a,"%2C%201000)&$format=JSON"),headers:m()});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))().then((function(t){var e=t.data.map((function(t){return{uid:t.StationUID,name:t.StationName.Zh_tw,position:[t.StationPosition.PositionLat,t.StationPosition.PositionLon]}}));p(e)})).catch((function(t){return console.log(t)}))}}),[i,n]),s?s.map((function(t,e){return Object(y.jsx)(U.a,{position:t.position,icon:_,eventHandlers:{click:function(e){a(t.uid)}},children:t.name&&Object(y.jsx)(z.a,{children:t.name})},e)})):null}n(108);var G=P("here");function J(t){var e=t.showCurrentLocation,n=Object(E.a)(),r=Object(a.useState)(null),i=Object(u.a)(r,2),o=i[0],c=i[1];return Object(a.useEffect)((function(){n&&e&&n.locate().on("locationfound",(function(t){c(t.latlng),n.flyTo(t.latlng,n.getZoom())}))}),[n,e]),null===o?null:Object(y.jsx)(U.a,{position:o,icon:G,children:Object(y.jsx)(z.a,{children:"\u73fe\u5728\u4f4d\u7f6e"})})}function W(t){var e=t.flyto,n=Object(E.a)();return Object(a.useEffect)((function(){n&&e&&n.flyTo(e,n.getZoom())}),[n,e]),null}function H(t){var e=t.markers,n=t.polyline,r=t.showCurrentLocation,i=t.showNearbyBikes,o=t.setbikeStationUid,c=Object(a.useState)(),s=Object(u.a)(c,2),l=s[0],d=s[1];return Object(a.useEffect)((function(){n&&d(n[0])}),[n]),Object(y.jsxs)(N.a,{center:[25.04795444238345,121.51693473083246],zoom:15,children:[l&&Object(y.jsx)(W,{flyto:l}),Object(y.jsx)(A.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e&&Object(y.jsx)(D,{markers:e}),n&&Object(y.jsx)(B.a,{pathOptions:{color:"red"},positions:n}),r&&Object(y.jsx)(J,{showCurrentLocation:r}),i&&Object(y.jsx)(D,{type:["bike"],setbikeStationUid:o})]})}function Z(){var t=r.a.useState(),e=Object(u.a)(t,2),n=e[0],a=e[1],i=r.a.useState(),o=Object(u.a)(i,2),c=o[0],s=o[1],p=r.a.useState(),h=Object(u.a)(p,2),f=h[0],g=h[1],v=r.a.useState(),S=Object(u.a)(v,2),w=S[0],T=S[1],C=r.a.useState(!1),E=Object(u.a)(C,2),U=E[0],z=E[1],N=r.a.useState(""),A=Object(u.a)(N,2),B=A[0],I=A[1];r.a.useEffect((function(){Object(d.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j()({method:"get",url:"https://ptx.transportdata.tw/MOTC/v2/Cycling/Shape/Taipei?$top=4&$format=JSON",headers:m()});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))().then((function(t){a(t.data)})).catch((function(t){return console.log(t)}))}),[]);return Object(y.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[Object(y.jsx)("div",{style:{position:"absolute",top:8,left:8,zIndex:401},children:n&&Object(y.jsx)(k,{list:n,handleClick:function(t){if(t.Geometry){var e=t.Geometry.replace(/(MULTILINESTRING\s\(\()|(\)\))/g,"").split(",").map((function(t){return t.split(" ").map((function(t){return parseFloat(t)})).reverse()}));g(e),s([{name:t.RoadSectionStart,position:e[0]},{name:t.RoadSectionEnd,position:e[e.length-1]}])}}})}),B&&Object(y.jsx)("div",{style:{position:"absolute",bottom:8,right:8,zIndex:401,width:"50%"},children:Object(y.jsx)(R,{bikeStationUid:B})}),Object(y.jsxs)("div",{style:{position:"absolute",top:8,right:8,zIndex:401},children:[Object(y.jsx)("div",{style:{backgroundColor:"#fff",borderRadius:"50%"},children:Object(y.jsx)(b.a,{color:"primary","aria-label":"add to shopping cart",onClick:function(){return z([])},children:Object(y.jsx)(O.a,{})})}),Object(y.jsx)("div",{style:{marginTop:"8px"}}),Object(y.jsx)("div",{style:{backgroundColor:"#fff",borderRadius:"50%"},children:Object(y.jsx)(b.a,{color:"primary","aria-label":"add to shopping cart",onClick:function(){return T([])},children:Object(y.jsx)(x.a,{})})})]}),Object(y.jsx)(H,{markers:c,polyline:f,showCurrentLocation:w,showNearbyBikes:U,setbikeStationUid:I})]})}n(109);var X=function(){return Object(y.jsxs)("div",{style:{padding:"10px",width:"100wh",height:"100vh"},children:[Object(y.jsx)(c.a,{}),Object(y.jsx)(Z,{})]})};o.a.render(Object(y.jsx)(r.a.StrictMode,{children:Object(y.jsx)(X,{})}),document.getElementById("root"))}},[[111,1,2]]]);
//# sourceMappingURL=main.4d7f0d91.chunk.js.map